<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Connected World</title>
    <!-- Link to your external CSS file -->
    <link rel="stylesheet" href="style.css"> <!-- Adjust the path as necessary -->
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
        }
    </style>
</head>

<body>

    <div id="info-box" class="info-box">
        <h2 id="country-name"></h2>
        <p id="country-code"></p>
        <button id="close-button">Close</button>
    </div>
    

    <div id="map-canvas"></div>

    <!-- Link to jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Link to Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiwuNykdMSzjhCcRmag9wIR4987puqEwM"></script>
    <!-- Link to your external JavaScript file -->
    <script src="map.js"></script> <!-- Adjust the path as necessary -->

    <script>
        $(document).ready(function() {
            let countries = [];

            let mapOptions = {
                zoom: 3,
                minZoom: 1,
                center: new google.maps.LatLng(50.7244893, 3.2668189),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                backgroundColor: 'none'
            };

            let map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

            init();

            function init() {
                $.ajax({
                    url: 'data.json',
                    cache: true,
                    dataType: 'json',
                    async: true,
                    success: function(data) {
                        if (data) {
                            $.each(data, function(id, country) {
                                var countryCoords;
                                var ca;
                                var co;

                                if ('multi' in country) {
                                    var ccArray = [];
                                    for (var t in country['xml']['Polygon']) {
                                        countryCoords = [];
                                        co = country['xml']['Polygon'][t]['outerBoundaryIs']['LinearRing']['coordinates'].split(' ');

                                        for (var i in co) {
                                            ca = co[i].split(',');
                                            countryCoords.push(new google.maps.LatLng(ca[1], ca[0]));
                                        }
                                        ccArray.push(countryCoords);
                                    }
                                    createCountry(ccArray, country);
                                } else {
                                    countryCoords = [];
                                    co = country['xml']['outerBoundaryIs']['LinearRing']['coordinates'].split(' ');

                                    for (var j in co) {
                                        ca = co[j].split(',');
                                        countryCoords.push(new google.maps.LatLng(ca[1], ca[0]));
                                    }
                                    createCountry(countryCoords, country);
                                }
                            }.bind(this));
                            showCountries();
                        }
                    }.bind(this)
                });
            }

            function showCountries() {
                for (var i = 0; i < countries.length; i++) {
                    countries[i].setMap(map);
                    google.maps.event.addListener(countries[i], "mouseover", function() {
                        this.setOptions({ fillColor: "#f5c879", fillOpacity: 0.5 });
                    });
                    google.maps.event.addListener(countries[i], "mouseout", function() {
                        this.setOptions({ fillColor: "#f5c879", fillOpacity: 0 });
                    });
                    google.maps.event.addListener(countries[i], 'click', function(event) {
                        // Call the toggle function to display the info box
                        toggleInfoBox(this.title, 'ISO Code: ' + this.code);
                    });
                }
            }

            function createCountry(coords, country) {
                var currentCountry = new google.maps.Polygon({
                    paths: coords,
                    title: country.country,
                    code: country.iso,
                    strokeOpacity: 0,
                    fillOpacity: 0
                });
                countries.push(currentCountry);
            }

            // Function to toggle the visibility of the info box
            function toggleInfoBox(countryName, countryCode) {
                const infoBox = document.getElementById('info-box');
                const countryNameElement = document.getElementById('country-name');
                const countryCodeElement = document.getElementById('country-code');

                // Update content and toggle display
                if (infoBox.style.display === 'none' || infoBox.style.display === '') {
                    countryNameElement.textContent = countryName;
                    countryCodeElement.textContent = countryCode;
                    infoBox.style.display = 'block'; // Show the info box
                } else {
                    infoBox.style.display = 'none'; // Hide the info box
                }
            }
        });
    </script>

</body>
</html>
